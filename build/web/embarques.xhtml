<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>SAPSG - RFID</title>

        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
    
        <link href="view/dist/css/style.css" rel="stylesheet" />
        <link rel="stylesheet" type="text/css" href="https://paramquery.com/pro2/Content/css6.2.4/pqgrid.min.css" />
        <link rel="stylesheet" type="text/css" href="https://paramquery.com/pro2/Content/css6.2.4/pqgrid.ui.min.css" />
        <link rel="stylesheet" type="text/css" href="https://paramquery.com/pqselect/trial/pqselect.min.css" />
        <link rel="stylesheet" type="text/css" href="https://paramquery.com/Content/css2.4.1/themes/Office/pqgrid.css" />
            
        <script src="https://code.highcharts.com/highcharts.js"></script>
        <script src="https://code.highcharts.com/modules/exporting.js"></script>
        <script src="https://code.highcharts.com/modules/export-data.js"></script>
        <script src="https://code.highcharts.com/modules/accessibility.js"></script>
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
        
        
        <style>
            .form-control,body, .dropdown-item{
    		font-size: .7rem;
            }
            
            .form-control {padding: 3px;min-height: 30px;}
            .page-wrapper, .footer{margin-left: 40px; margin-right: -20px; margin-top: -83px;}
            .page-wrapper {background: #ffffff;}
             body {background-color: #ffffff; color: #000000;}
            
             
             @media only screen and (max-width: 768px) {
                .page-wrapper, .footer {
                    margin-left: -15px;
                    margin-right: -20px;
                    margin-top: -109px;
                }
                    
                 .container-fluid {
                        padding: 0px 0px 0px 0px;
                    }
             }
             
             .modal-lg {
                max-width: 45%;
                max-height: 100%;
                height: 100%;
            }
            
            
            
            .ui-widget-header {
                border: 1px solid #dddddd;
                background: #e9e9e9;
                color: #333333;
                font-weight: bold;
            }
            
    
        
    .btn-primary {
        color: #fff;
        background-color: #007bff;
        border-color: #007bff;
    }
    
    .btn-primary.disabled, .btn-primary:disabled {
        color: #fff;
        background-color: #007bff;
        border-color: #007bff;
    }
    
    .btn-primary:hover {
        color: #fff;
        background-color: #007bff;
        border-color: #007bff;
    }
    
    .btn-default {
        color: #fff;
        background-color: #6c757d;
        border-color: #6c757d;
    }
        
    .table tr {
            cursor: pointer;
    }
    
    .gj-width-full{
        display: block;
        width: 100%;
        padding: 0.375rem 0.75rem;
        font-size: 0.875rem;
        line-height: 1.5;
        color: #4F5467;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid #e9ecef;
        border-radius: 0.25rem;
    }
    #grid2.table th, .table td {
        padding: 0px;
        font-size: 11px
    }

    table.gj-grid{
        table-layout: unset !important;
    }
    .gj-grid-bootstrap-4 tbody tr td[data-mode="edit"] [data-role="edit"] input[type="text"] {
        height: 34px;
    }
    
    .highcharts-figure, .highcharts-data-table table {
    min-width: 320px; 
    max-width: 800px;
    margin: 1em auto;
    }

    .highcharts-data-table table {
            font-family: Verdana, sans-serif;
            border-collapse: collapse;
            border: 1px solid #EBEBEB;
            margin: 10px auto;
            text-align: center;
            width: 100%;
            max-width: 500px;
    }
    .highcharts-data-table caption {
        padding: 1em 0;
        font-size: 1.2em;
        color: #555;
    }
    .highcharts-data-table th {
        font-weight: 600;
        padding: 0.5em;
    }
    .highcharts-data-table td, .highcharts-data-table th, .highcharts-data-table caption {
        padding: 0.5em;
    }
    .highcharts-data-table thead tr, .highcharts-data-table tr:nth-child(even) {
        background: #f8f8f8;
    }
    .highcharts-data-table tr:hover {
        background: #f1f7ff;
    }


    input[type="number"] {
            min-width: 50px;
    }
    </style>

    </h:head>
    <h:body class="skin-default-dark fixed-layout">
        <h:form> 
            <p:remoteCommand name="nones" action="#{inventariobean.processJson()}"></p:remoteCommand>
            <p:remoteCommand name="bcrLike" action="#{inventariobean.gfEmbLike()}"></p:remoteCommand>
            <p:remoteCommand name="bcrNave" action="#{inventariobean.buscarEmb()}"></p:remoteCommand>
            <p:remoteCommand name="bcrPL" action="#{inventariobean.cargarDatosVin()}"></p:remoteCommand>
            <p:remoteCommand name="datosGr" action="#{inventariobean.graficoNone()}"
                             onerror="alert('ERROR! No se pudo registrar el material, favor volver a intentar mas tarde.')"></p:remoteCommand>
            <p:remoteCommand name="rmd" action="#{inventariobean.getAllNave()}"></p:remoteCommand>

        </h:form>

    <div id="main-wrapper">
        <div class="page-wrapper">
            <br></br>
            
            <div class="container-fluid">                            
                <div class="row">
                    <div class="col-12">
                        
                        
                        <div class="card">
                            <div class="card-body">

                                <form name="form1" id="form1">
                                    <br></br>
                                    <div >
                                        <div class="row">
                                            <div class="col col-12">
                                                <div class="buscarNave">
                                                    Por Nave: <input id="cNV" name="numero" class="form-control" autocomplete="off" style="text-transform:uppercase; width: 100px;"/>
                                                    <a type="button" class="btn btn-secondary" id="match_code" style="color: black; padding: 3px" onclick="buscarAllNaves(); botonMatchCode();"><i class="fa fa-clone"></i></a>
                                                </div>
                                                <br></br>
                                            </div>
                                            <div class="col col-12">
                                                <a type="button" class="btn btn-secondary" id="btnBuscar" style="color: black; margin-bottom: 10px; display: none;" onclick="botonBuscar();" ><i class="fa fa-search"></i></a>
                                                <a type="button" class="btn btn-secondary" id="btnGrafico" style="color: black; margin-bottom: 10px; display: none;" onclick="botonGrafico();"><i class="fa fa-chart-pie"></i></a>
                                                <a type="button" class="btn btn-secondary" id="btnVolver2" style="color: black; margin-bottom: 10px; display: none;" onclick="botonVolver2();"><i class="fa fa-arrow-left"></i></a>
                                                <a type="button" class="btn btn-secondary" id="btnVolver" style="color: black; margin-bottom: 10px; display: none;" onclick="botonVolver();"><i class="fa fa-arrow-left"></i></a>
                                                
                                                <div id="tbl-ex" class="table-responsive" style="margin-top: -15px">  
                                                    <div id="example" class="table table-striped"></div>
                                                    
                                                    <div id="example_pl" class="table table-striped"></div>
                                                    
                                                    <div id="table_match" class="table table-striped"></div>
                                                    
                                                    <div id="modal-grafico" class="table table-striped"></div>
                                                    
                                                    <div title="Grid in Dialog" id="popup" style="overflow:hidden;">
                                                        <div id="grid_popup"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>                                        
                                    </div>
                                    
                                </form>
                                    <div id="datos_grafico" style="display: none; ">  
                                        <div id='datos1'>
                                            <h5 style="color: #000;">Total Nave: <a id="total_Nave"></a></h5>
                                            <h7 style="color: #000;">Ingresados: <a id="total_ing"></a></h7>                                     
                                        </div>
                                        <h7 style="color: #000;">Pendientes: <a id="total_ning"></a></h7>
                                        <div id="grafico_Dona"> <!--  -->
                                            <figure class="highcharts-figure">
                                                <div id="container"></div>
                                            </figure>
                                        </div>  
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>   
    </div>
    <!-- ============================================================== -->
    <!-- All Jquery -->
    <!-- ============================================================== -->
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js" type="text/javascript"></script>
    
    <script src="https://kit.fontawesome.com/19d50627e7.js"></script>
    <!--<link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.css" rel="stylesheet" type="text/css" />-->
    <script type="text/javascript" src="https://paramquery.com/pqselect/trial/pqselect.min.js"></script>
    <script type="text/javascript" src="view/pqgrid.min.js"></script>
    <script type="text/javascript" src="view/pq-localize-en.js"></script>
    


        <script>
        //<![CDATA[  
                      
            function soloNumeros(e){
                var key = window.event ? e.which : e.keyCode;
                if (key < 48 || key > 57) {
                  e.preventDefault();
                }
            }
            
            //Botones
            function botonBuscar(){
                $('#example_pl').remove();
                $('#table_match').remove();
                $('#btnBuscar').hide();
                $('#btnGrafico').hide();
                $('.buscarNave').show();
                $('#example').hide();
                $('#grafico_Dona').find('div').remove();
                $('#datos_grafico').hide();
                $('#btnVolver').hide();
                $('#cNV').val("");
                $('#grid_popup').hide();
                $('#btnVolver2').hide();
            }
            
            function botonGrafico(){
                $('#example_pl').hide();
                $('#btnVolver').show();
                $('#btnGrafico').hide();
                $('#btnVolver2').hide();
                getDataGrafico();
            }
            
            function botonVolver(){
                $('#example_pl').show();
                $('#btnVolver').hide();
                $('#btnVolver2').show();
                $('#btnGrafico').show();
                $('#grafico_Dona').find('div').remove();
                $('#datos_grafico').hide();
                $('#grid_popup').hide();
            }
            
            function botonVolver2(){
                $('.buscarNave').show();
                $('#btnBuscar').hide();
                $('#btnVolver').hide();
                $('#btnGrafico').hide();
                $('#example_pl').hide();
                $('#example').show();
                $('#btnVolver2').hide();
                $('#table_match').show();
            }
            
            function botonMatchCode(){
                $('#example').remove();
            }
            
            var nem;
            var vem;
            var doto;
            function buscarGrafico(arrGrafico){  
                $('#card_info').show();
                
                
                //$('.card-body').append('<div id="datos_grafico"><div id="datos1"><h5 style="color: #000;">Total Nave: <a id="total_Nave"></a></h5><h7 style="color: #000;">Ingresados: <a id="total_ing"></a></h7></div><h7 style="color: #000;">Pendientes: <a id="total_ning"></a></h7></div>');
                //$('#datos_grafico').append('<div id="grafico_Dona"></div>');
                $('#grafico_Dona').find('div').remove();
                
                var $container = $('<div>').appendTo('#grafico_Dona');
                
                window.chart = new Highcharts.Chart({
                    chart: {
                        renderTo: $container[0],
                        height: 400,
                        plotBackgroundColor: null,
                        plotBorderWidth: null,
                        plotShadow: false,
                        type: 'pie'
                    },
                    title: {
                        text: 'Total Vehiculos Ingresados - Nave: ' + nem + ' y Viaje: ' + vem + '. '
                    },
                    tooltip: {
                        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                    },
                    accessibility: {
                        point: {
                            valueSuffix: '%'
                        }
                    },
                    plotOptions: {
                        pie: {
                            
                            cursor: 'pointer',
                            dataLabels: {
                                enabled: true,
                                format: '<b>{point.name}</b>: {point.percentage:.1f} %'
                            },
                            events: {
                                click: function (event) {
                                    doto = event.point.y;
                                    var nombre = event.point.name;
                                    if (nombre == 'Ingresado'){
                                        doto = 2;
                                    }
                                    else{
                                        doto = 1;
                                    }
                                    buscarData();
                                    
                                    $("button#open_popup").button().click(function (evt) {
                                        $("#popup")            
                                        .dialog({
                                            height: 300,
                                            width: 700,
                                            //width: 'auto',
                                            modal: true,
                                            open: function (evt, ui) {   
                                                $("#grid_popup").pqGrid(obj);
                                            },
                                            close: function () {
                                                $("#grid_popup").pqGrid('destroy');
                                            },
                                            show: {
                                                effect: "blind",
                                                duration: 500
                                            }
                                        });
                                    }).click();
                                    
                                    $('#grid_popup').show();
                                }
                            }
                        }
                    },
                    series: [{
                        name: 'Cantidad',
                        colorByPoint: true,
                        data: arrGrafico
                    }],
                    colors: [
                        '#2f7ed8', '#DB843D'
                    ]
                });
                
                

                $('.highcharts-credits').remove();
            }
            
            var arrGrafico = [{
                                name: 'Ingresado',
                                y: 40.00,
                                sliced: true,
                                selected: true
                            }, {
                                name: 'No Ingresado',
                                y: 60.00
                            }];           
            
            $('#cNV').keyup(function() {
                $('#table_match').remove();
                if ($('#cNV').val() == ""){
                    $('#example').hide();   
                }else{                      
                    buscarNaveLike();
                    $('#table_match').remove();
                }
            });
            
            function buscarData(){   
                var allx = nem + "%" + vem + "%" + doto;
                
                datosGr([{name:'jsonParam', value: allx }]);
            }
            
            function setGetGrafico(arr){
                
                $('#grid_popup').remove();
                $('.table-responsive').append('<div id="grid_popup"></div>');
                
                //define custom condition.        
                pq.filter.conditions.notbetween = {
                    filter: {
                        type: 'textbox2', //type of UI control.
                        init: pq.filter.datepicker //use inbuilt init callback.
                    },
                    number: 1, date: 1,//condition applicable to number and date dataType
                    compare: function (cellData, val, val2) {
                        //debugger;
                        return (cellData < val || cellData > val2);
                    }
                }


                //define localization string for custom condition.        
                $.paramquery.pqGrid.defaults.strConditions.notbetween = "Not between";

                var obj = {
                    width: "auto", //auto width
                    height: "250", //height in %age
                    selectionModel: { type: 'cell' },
                    autoSizeInterval: 0,
                    scrollModel: { autoFit: true },
                    dragColumns: false,
                    //showTop: false,
                    showBottom: false,                   
                    menuIcon: true,
                    numberCell: { show: true },            
                    formulas:[["diff_date", function( rd ){
                        var oneDay = 24*60*60*1000,
                            firstDate = new Date(rd.ShippedDate),
                            secondDate = new Date(rd.OrderDate),
                            diff = Math.round(Math.abs((firstDate.getTime() - secondDate.getTime())/(oneDay)));            
                        if( !isNaN(diff) ){
                            return diff;
                        }
                    }]],
                    toolbar: {
                        cls: 'pq-toolbar',
                        items: [
                            {
                                type: 'select',
                                cls:'rpp',
                                label: "",
                                options: [20, 50, 100, 1000],
                                listener: function(evt) {
                                    this.option('pageModel.rPP', $(evt.target).val())
                                    this.refreshDataAndView();
                                }
                            },
                            {
                                type: 'textbox',
                                cls: 'curpage',
                                label: "Página N°: ",
                                listener: function(evt) {
                                    this.goToPage({page:$(evt.target).val()})
                                }
                            },
                            { type: 'separator'},
                            {
                                type: 'button',
                                label: "Anterior",
                                cls:'prev btn btn-light',
                                listener: function() {
                                    var page = this.option('pageModel.curPage');
                                    this.goToPage({page: page-1})
                                }
                            },
                            {
                                type: 'button',
                                label: "Siguiente",
                                cls:'next btn btn-light',
                                listener: function() {
                                    var page = this.option('pageModel.curPage');
                                    this.goToPage({page: page+1})
                                }
                            }
                        ]
                    }

                };
                
                obj.columnTemplate = {
                    width: '25%', //column width in %age
                    editor: { style: 'z-index:10000;position:relative;' }
                };
                
                //define colModel
                obj.colModel = [
                    { title: "VIN", dataIndx: "VIN", cls:"vin_grafico", width: "25%"
                    },              
                    { title: "ESTATUS", dataIndx: "descr", cls: "est_grafico", width: "25%"
                    }
                ];
                
                obj.dataModel = { data: arr };
                
                obj.editorBegin = function(event, ui){
                   if(confirm('Desea editar este objeto?')){
                       return true;
                   }else{
                       event.preventDefault();
                   }

               }

                obj.editorEnd = function(event, ui){
                   var row = ui.rowData;
                   return true;

               }
                obj.columnOrder = function(event, ui){
                   setTimeout(function(){
                       $('body').find('.btn_act:eq(1) span').remove();
                       $('body').find('.btn_act:eq(0) span.pq-menu-icon').remove();
                       return true;
                   }, 100);

               }

                obj.refresh = function(event, ui){
                   setTimeout(function(){
                       $('body').find('.btn_act:eq(1) span').remove();
                       $('body').find('.btn_act:eq(0) span.pq-menu-icon').remove();
                       return true;
                   }, 100);

               }
                obj.beforeSort = function(event, ui){
                   setTimeout(function(){
                       $('body').find('.btn_act:eq(1) span').remove();
                       $('body').find('.btn_act:eq(0) span.pq-menu-icon').remove();
                       return true;
                   }, 100);

               }   
               
                
                $("#grid_popup").pqGrid(obj);
        
                $('body').find('div').last().hide();
            }
            
            function ocultarGracico(){
                $('#datos_grafico').hide();
                $('.buscarNave').show();
            }
            
            function buscarNaveLike() {
                $('#example').show();
                $('#card_info').hide();
                $('#cNV').val($('#cNV').val().toUpperCase());
                var nave = $('#cNV').val();
                
                var allx = nave;
                
                bcrLike([{name:'jsonParam', value: allx }]);
            }
            
            var table;
            function setBuscarEmb(arr){               
                $('#example').remove();
                $('#example').show();
                $('.table-responsive').append("<div id='example'></div>");


                //define colModel
                var colM = [
                    { title: "NAVE", dataIndx: "N_EMBARQUE", cls:"nave_code", width: "30%"
                    },              
                    { title: "VIAJE", dataIndx: "VIAJE", cls: "viaje_code", width: "30%"
                    },
                    { title: "ESTATUS", dataIndx: "descr", cls: "descr_code", width: "40%"
                    }
                ];
                var obj = {
                    height: 400,
                    colModel: colM,  
                    dataModel: {
                        data: arr
                        //url: "/pro/orders/get",//for ASP.NET
                        //url: "/orders.php", //for PHP
                    },
                    //scrollModel: {autoFit: true},          
                    //flex: {one: true},
                    pageModel: { type: "local", rPP: 20, rPPOptions: [10, 50, 100, 500, 1000] },            
                    showBottom: true,            
                    wrap: false, hwrap: false,
                    editable: false,
                    selectionModel: { type: 'row' },
                    resizable: true,
                    rowSelect: function (evt, ui) {
                        console.log('rowSelect', ui);
                        var str = JSON.stringify(ui, function(key, value){                    
                            if( key.indexOf("pq_") !== 0){
                                return value;
                            }
                        }, 2)
                            nem = ui.addList[0].rowData['N_EMBARQUE'];
                            vem = ui.addList[0].rowData['VIAJE'];
                            getDataRowBtn(nem, vem);
                    },
                    dragColumns: false,
                    numberCell: { show: true },            
                    formulas:[["diff_date", function( rd ){
                        var oneDay = 24*60*60*1000,
                            firstDate = new Date(rd.ShippedDate),
                            secondDate = new Date(rd.OrderDate),
                            diff = Math.round(Math.abs((firstDate.getTime() - secondDate.getTime())/(oneDay)));            
                        if( !isNaN(diff) ){
                            return diff;
                        }
                    }]],
                    toolbar: {
                        cls: 'pq-toolbar',
                        items: [
                            {
                                type: 'select',
                                cls:'rpp',
                                label: "",
                                options: [20, 50, 100, 1000],
                                listener: function(evt) {
                                    this.option('pageModel.rPP', $(evt.target).val())
                                    this.refreshDataAndView();
                                }
                            },
                            {
                                type: 'textbox',
                                cls: 'curpage',
                                label: "Página N°: ",
                                listener: function(evt) {
                                    this.goToPage({page:$(evt.target).val()})
                                }
                            },
                            { type: 'separator'},
                            {
                                type: 'button',
                                label: "Anterior",
                                cls:'prev btn btn-light',
                                listener: function() {
                                    var page = this.option('pageModel.curPage');
                                    this.goToPage({page: page-1})
                                }
                            },
                            {
                                type: 'button',
                                label: "Siguiente",
                                cls:'next btn btn-light',
                                listener: function() {
                                    var page = this.option('pageModel.curPage');
                                    this.goToPage({page: page+1})
                                }
                            }
                        ]
                    }

                };
        
                   
                
                $("#example").pqGrid(obj);
        
                $('body').find('div').last().hide();
                $('body').find('.btn_act:eq(1) span').remove();
                $('body').find('.btn_act:eq(0) span.pq-menu-icon').remove();
            }
            
            //Obtiene los datos de la fila seleccionada
            function getDataRow(e) {
                $('.buscarNave').hide();
                $('#btnGrafico').show();
                $('#btnBuscar').show();
                $('#btnVolver2').show();
                
                nem = $(e).parent().parent().find('.nave_code').text();
                vem = $(e).parent().parent().find('.viaje_code').text();
                
                var getPL = nem + "%" + vem;
                bcrPL([{name:'jsonParam', value: getPL}]);
                $('#example').hide();
                $("#table_match").hide();
            }
            
            //Obtiene los datos de la fila seleccionada sin boton
            function getDataRowBtn(nave, viaje){
                $('.buscarNave').hide();
                $('#btnGrafico').show();
                $('#btnBuscar').show();
                $('#btnVolver2').show();

                var getPL = nave + "%" + viaje;
                bcrPL([{name:'jsonParam', value: getPL}]);
                $('#example').hide();
                $("#table_match").hide();
            }
            
            function setGetVinPL(arr){
                $('#example_pl').remove();                
                $('.table-responsive').append("<div id='example_pl'></div>");

                //define colModel
                var colM = [
                    { title: "MARCA", dataIndx: "MARCA", cls:"marca_code", width: "10%"
                    },
                    { title: "VIN", dataIndx: "VIN", cls: "vin_code", width: "15%"
                    },
                    { title: "MOTOR", dataIndx: "MOTOR", cls: "motor_code", width: "15%"
                    },
                    { title: "MODELO", dataIndx: "MODELO", cls: "modelo_code", width: "25%"
                    },
                    { title: "MATERIAL", dataIndx: "MATNR", cls: "material_code", width: "14%"
                    },
                    { title: "NAVE", dataIndx: "NAVE", cls: "nave_code", width: "10%"
                    },
                    { title: "VIAJE", dataIndx: "VIAJE", cls: "viaje_code", width: "10%"
                    }
                ];
                var obj = {
                    height: 725,
                    colModel: colM,  
                    dataModel: {
                        data: arr
                        //url: "/pro/orders/get",//for ASP.NET
                        //url: "/orders.php", //for PHP
                    },
                    //scrollModel: {autoFit: true},          
                    //flex: {one: true},
                    pageModel: { type: "local", rPP: 22, rPPOptions: [10, 50, 100, 500, 1000] },            
                    showBottom: true,            
                    wrap: false, hwrap: false,
                    editable: false,                  
                    dragColumns:false,
                    numberCell: false,
                    toolbar: {
                        cls: 'pq-toolbar',
                        items: [
                            {
                                type: 'select',
                                cls:'rpp',
                                label: "",
                                options: [20, 50, 100, 1000],
                                listener: function(evt) {
                                    this.option('pageModel.rPP', $(evt.target).val())
                                    this.refreshDataAndView();
                                }
                            },
                            {
                                type: 'textbox',
                                cls: 'curpage',
                                label: "Página N°: ",
                                listener: function(evt) {
                                    this.goToPage({page:$(evt.target).val()})
                                }
                            },
                            { type: 'separator'},
                            {
                                type: 'button',
                                label: "Anterior",
                                cls:'prev btn btn-light',
                                listener: function() {
                                    var page = this.option('pageModel.curPage');
                                    this.goToPage({page: page-1})
                                }
                            },
                            {
                                type: 'button',
                                label: "Siguiente",
                                cls:'next btn btn-light',
                                listener: function() {
                                    var page = this.option('pageModel.curPage');
                                    this.goToPage({page: page+1})
                                }
                            }
                        ]
                    }

                };
           
                
                $("#example_pl").pqGrid(obj);
        
                $('body').find('div').last().hide();
                $('body').find('.btn_act:eq(1) span').remove();
                $('body').find('.btn_act:eq(0) span.pq-menu-icon').remove();
            }
            
            function getDataGrafico(){
                var allx = nem + "%" + vem;
                bcrNave([{name:'jsonParam', value: allx }]);
            }
            
            function setEmb(arr){
                if (arr != "")
                {
                   var emb = arr[0].N_EMBARQUE;
                    var vje = arr[0].VIAJE;
                    var sts = arr[0].descr;
                    var ing = parseInt(0);
                    var noing = parseInt(0);
                    var total;

                    arr.forEach(function (i, x){ 
                       total = x + 1; 
                       var id = i.id;
                       if (id == 2){
                           ing += 1;
                       }else {
                           noing += 1;
                       }
                    });

                    $('#datos_grafico').show();
                    $('.buscarNave').hide();
                    $('#total_Nave').text(total);
                    $('#total_ing').text(ing);
                    $('#total_ning').text(noing);

                    var arrGrafico2 = [{
                                    name: 'Ingresado',
                                    y: ing,
                                    sliced: true
                                }, {
                                    name: 'Pendientes',
                                    y: noing
                                }];
                        
                    buscarGrafico(arrGrafico2);
                    
                }else {
                    swal("", "Este embarque no tiene infomarción.", "error");
                }
                    
            }
            
            function buscarAllNaves(){
                rmd();
            }          
            
            function setGetAllNave(arr){
                $('#table_match').remove();                
                $('.table-responsive').append("<div id='table_match'></div>");
               
                //define colModel
                var colM = [            
                    { title: "NAVE", dataIndx: "NAVE", cls: "nave_code", width: "30%"
                    },
                    { title: "VIAJE", dataIndx: "VIAJE", cls: "viaje_code", width: "30%"
                    },
                    { title: "ESTATUS", dataIndx: "descr", cls: "descr_code", width: "40%"
                    }
                ];
                var obj = {
                    height: 400,
                    colModel: colM,  
                    dataModel: {
                        data: arr
                        //url: "/pro/orders/get",//for ASP.NET
                        //url: "/orders.php", //for PHP
                    },
                    //scrollModel: {autoFit: true},          
                    flex: {one: true},
                    pageModel: { type: "local", rPP: 20, rPPOptions: [10, 50, 100, 500, 1000] },            
                    showBottom: true,            
                    wrap: false, hwrap: false,
                    editable: false,
                    selectionModel: { type: 'row' },
                    resizable: true,
                    rowSelect: function (evt, ui) {
                        console.log('rowSelect', ui);
                        var str = JSON.stringify(ui, function(key, value){                    
                            if( key.indexOf("pq_") !== 0){
                                return value;
                            }
                        }, 2)
                            nem = ui.addList[0].rowData['NAVE'];
                            vem = ui.addList[0].rowData['VIAJE'];
                            getDataRowBtn(nem, vem);
                    },
                    dragColumns: false,
                    numberCell: { show: true },            
                    formulas:[["diff_date", function( rd ){
                        var oneDay = 24*60*60*1000,
                            firstDate = new Date(rd.ShippedDate),
                            secondDate = new Date(rd.OrderDate),
                            diff = Math.round(Math.abs((firstDate.getTime() - secondDate.getTime())/(oneDay)));            
                        if( !isNaN(diff) ){
                            return diff;
                        }
                    }]],
                    toolbar: {
                        cls: 'pq-toolbar',
                        items: [
                            {
                                type: 'select',
                                cls:'rpp',
                                label: "",
                                options: [20, 50, 100, 1000],
                                listener: function(evt) {
                                    this.option('pageModel.rPP', $(evt.target).val())
                                    this.refreshDataAndView();
                                }
                            },
                            {
                                type: 'textbox',
                                cls: 'curpage',
                                label: "Página N°: ",
                                listener: function(evt) {
                                    this.goToPage({page:$(evt.target).val()})
                                }
                            },
                            { type: 'separator'},
                            {
                                type: 'button',
                                label: "Anterior",
                                cls:'prev btn btn-light',
                                listener: function() {
                                    var page = this.option('pageModel.curPage');
                                    this.goToPage({page: page-1})
                                }
                            },
                            {
                                type: 'button',
                                label: "Siguiente",
                                cls:'next btn btn-light',
                                listener: function() {
                                    var page = this.option('pageModel.curPage');
                                    this.goToPage({page: page+1})
                                }
                            }
                        ]
                    }

                };
        
                obj.editorBegin = function(event, ui){
                   if(confirm('Desea editar este objeto?')){
                       return true;
                   }else{
                       event.preventDefault();
                   }

               }

                obj.editorEnd = function(event, ui){
                   var row = ui.rowData;
                   return true;

               }
                obj.columnOrder = function(event, ui){
                   setTimeout(function(){
                       $('body').find('.btn_act:eq(1) span').remove();
                       $('body').find('.btn_act:eq(0) span.pq-menu-icon').remove();
                       return true;
                   }, 100);

               }

                obj.refresh = function(event, ui){
                   setTimeout(function(){
                       $('body').find('.btn_act:eq(1) span').remove();
                       $('body').find('.btn_act:eq(0) span.pq-menu-icon').remove();
                       return true;
                   }, 100);

               }
                obj.beforeSort = function(event, ui){
                   setTimeout(function(){
                       $('body').find('.btn_act:eq(1) span').remove();
                       $('body').find('.btn_act:eq(0) span.pq-menu-icon').remove();
                       return true;
                   }, 100);

               }   
                
                $("#table_match").pqGrid(obj);
        
                $('body').find('div').last().hide();
                $('body').find('.btn_act:eq(1) span').remove();
                $('body').find('.btn_act:eq(0) span.pq-menu-icon').remove();
            }
            
            function limpiarTabla() {
                //table.destroy();
            }
                       
        //]]>
        </script>
    </h:body>
</html>

